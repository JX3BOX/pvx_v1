(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9e42a320"],{"107cf":function(t,e,n){"use strict";n("354f")},"11a3":function(t,e,n){"use strict";n("b0c0"),n("99af");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"w-pvx-user"},[t.wiki_post&&t.wiki_post.post?e("div",{staticClass:"m-wiki-post-panel"},[e("WikiPanel",{attrs:{"wiki-post":t.wiki_post}},[e("template",{slot:"head-title"},[e("svg",{class:"u-icon",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 512 512","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M382.5 109.2C345.1 71.8 296.3 50 243.9 47v110.9c46.7 19.2 79.6 65.2 79.6 118.7 0 58-47.2 105.2-105.2 105.2-47.8 0-86.6-38.9-86.6-86.6 0-39.6 32.2-71.8 71.8-71.8 33.1 0 59.9 26.9 59.9 59.9h-25c0-19.3-15.7-34.9-34.9-34.9-25.8 0-46.8 21-46.8 46.8 0 34 27.6 61.6 61.6 61.6 44.2 0 80.1-35.9 80.1-80.1 0-57-46.3-103.3-103.3-103.3C122.3 173.3 63 232.6 63 305.6 63 398.4 138.5 474 231.4 474c57.1 0 110.7-22.2 151.1-62.6 40.4-40.4 62.6-94 62.6-151.1s-22.2-110.7-62.6-151.1z"}})]),e("span",{staticClass:"u-txt"},[t._v(t._s(t.name)+"攻略")])]),e("template",{slot:"head-actions"},[e("a",{staticClass:"el-button el-button--primary",attrs:{href:t.publish_url("".concat(t.type,"/").concat(t.id))}},[e("i",{staticClass:"el-icon-edit"}),e("span",[t._v("完善"+t._s(t.name)+"攻略")])])]),e("template",{slot:"body"},[t.compatible?e("div",{staticClass:"m-wiki-compatible"},[e("i",{staticClass:"el-icon-warning-outline"}),t._v(" 暂无缘起攻略，以下为重制攻略，仅作参考，"),e("a",{staticClass:"s-link",attrs:{href:t.publish_url("".concat(t.type,"/").concat(t.id))}},[t._v("参与修订")]),t._v("。 ")]):t._e(),e("Article",{attrs:{content:t.wiki_post.post.content}}),e("div",{staticClass:"m-wiki-signature"},[e("i",{staticClass:"el-icon-edit"}),t._v(" 本次修订由 "),e("b",[t._v(t._s(t.user_name))]),t._v(" 提交于"+t._s(t.updated_at)+" ")])],1)],2),t._t("serendipity"),e("WikiRevisions",{attrs:{type:t.type,"source-id":t.id}})],2):e("div",{staticClass:"m-wiki-post-empty"},[e("i",{staticClass:"el-icon-s-opportunity"}),e("span",[t._v("暂无攻略，我要")]),e("a",{staticClass:"s-link",attrs:{href:t.publish_url("".concat(t.type,"/").concat(t.id))}},[t._v("完善攻略")])]),e("Thx",{key:t.type+"-thx-"+t.id,staticClass:"m-thx",attrs:{postId:t.id,postType:t.type,postTitle:t.wiki_post.source.Name,userId:t.author_id,adminBoxcoinEnable:!1,userBoxcoinEnable:!1,authors:t.authors,mode:"wiki",client:t.client}}),e("WikiComments",{attrs:{type:t.type,"source-id":String(t.id)}})],1)},s=[],a=(n("4de4"),n("d3b7"),n("d81d"),n("9616")),o=n("1b86"),r=n("a974"),c=n("662c"),l=n("9307"),u=function(){var t=this,e=t._self._c;return e("WikiPanel",{staticClass:"c-wiki-comments",attrs:{scene:"detail"}},[e("template",{slot:"head-title"},[e("i",{staticClass:"el-icon-chat-line-round"}),e("span",[t._v("百科评论")])]),e("template",{slot:"body"},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-comments-panel"},[t.comments&&t.comments.length?t._e():e("div",{staticClass:"u-empty"},[null===t.comments?e("span",[t._v("🎉 数据加载中...")]):t._e(),!1===t.comments?e("span",[t._v("⚠️ 数据加载异常")]):t._e(),t.comments&&!t.comments.length?e("span",[t._v("💧 暂无评论")]):t._e()]),e("Comment",{attrs:{comments:t.comments,"source-id":t.sourceId}}),e("el-pagination",{staticClass:"u-pagination-box",attrs:{background:"","hide-on-single-page":"","current-page":t.page,total:t.total,"page-size":t.pageSize,layout:"prev, pager, next, total"},on:{"current-change":t.handleCurrentChange}}),e("div",{staticClass:"m-reply-form",attrs:{id:"m-reply-form"}},[e("h4",{staticClass:"u-title"},[e("i",{staticClass:"el-icon-chat-dot-round"}),e("span",[t._v("回复")])]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.reply_form.content,expression:"reply_form.content"}],staticClass:"u-reply-content",domProps:{value:t.reply_form.content},on:{input:function(e){e.target.composing||t.$set(t.reply_form,"content",e.target.value)}}}),e("div",{staticClass:"u-author"},[e("span",[t._v("昵称：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.reply_form.user_nickname,expression:"reply_form.user_nickname"}],attrs:{type:"text"},domProps:{value:t.reply_form.user_nickname},on:{input:function(e){e.target.composing||t.$set(t.reply_form,"user_nickname",e.target.value)}}})]),e("el-button",{staticClass:"u-submit",attrs:{type:"primary"},on:{click:function(e){return t.create_comment(t.reply_form)}}},[e("i",{staticClass:"el-icon-check"}),e("span",[t._v("提交")])])],1)],1)])],2)},m=[],p=(n("caad"),n("2532"),n("14d9"),function(){var t=this,e=t._self._c;return e("ul",{staticClass:"u-comments"},t._l(t.comments,(function(n,i){return e("li",{key:i,staticClass:"u-comment-panel"},[e("div",{staticClass:"u-comment"},[e("div",{staticClass:"u-nickname-panel"},[e("a",{staticClass:"u-nickname",attrs:{href:n.user_id?t.author_url(n.user_id):null,target:"_blank"},domProps:{textContent:t._s(n.user_nickname)}}),n.parent_id?[e("span",[t._v(" 回复 ")]),e("a",{staticClass:"u-nickname",attrs:{href:n.parent.user_id?t.author_url(n.parent.user_id):null,target:"_blank"},domProps:{textContent:t._s(n.parent.user_nickname)}})]:t._e()],2),e("p",{staticClass:"u-content",domProps:{innerHTML:t._s(n.content)}}),e("div",{staticClass:"m-reply"},[n.reply_form&&n.reply_form.show?e("el-button",{staticClass:"u-reply",attrs:{type:"default"},on:{click:function(t){n.reply_form.show=!n.reply_form.show}}},[e("i",{staticClass:"el-icon-arrow-up"}),e("span",[t._v("收起")])]):e("el-button",{staticClass:"u-reply",attrs:{type:"primary",plain:""},on:{click:function(t){n.reply_form.show=!n.reply_form.show}}},[e("i",{staticClass:"el-icon-chat-dot-round"}),e("span",[t._v("回复")])]),e("span",{staticClass:"u-time",domProps:{textContent:t._s(t.ts2str(n.updated))}})],1),n.reply_form&&n.reply_form.show?e("div",{staticClass:"m-reply-form"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:n.reply_form.content,expression:"comment.reply_form.content"}],staticClass:"u-reply-content",domProps:{value:n.reply_form.content},on:{input:function(e){e.target.composing||t.$set(n.reply_form,"content",e.target.value)}}}),e("div",{staticClass:"u-author"},[e("span",[t._v("昵称：")]),e("input",{directives:[{name:"model",rawName:"v-model",value:n.reply_form.user_nickname,expression:"comment.reply_form.user_nickname"}],attrs:{type:"text"},domProps:{value:n.reply_form.user_nickname},on:{input:function(e){e.target.composing||t.$set(n.reply_form,"user_nickname",e.target.value)}}})]),e("el-button",{staticClass:"u-submit",attrs:{type:"primary"},on:{click:function(e){return t.create_comment(n.reply_form,n.id)}}},[e("i",{staticClass:"el-icon-check"}),e("span",[t._v("提交")])])],1):t._e()]),n.children.length?e("WikiComment",{attrs:{comments:n.children,"source-id":t.sourceId}}):t._e()],1)})),0)}),d=[],_=n("85e4"),h={name:"WikiComment",props:["comments","sourceId"],methods:{author_url:_["authorLink"],ts2str:_["ts2str"],create_comment:function(t,e){var n=this.$parent;n.create_comment||(n=n.$parent),n.create_comment?n.create_comment(t,e):this.$message({message:"发布评论异常，请联系管理员",type:"warning"})}}},v=h,f=n("2877"),y=Object(f["a"])(v,p,d,!1,null,null,null),g=y.exports,k=n("c9d2"),C={name:"WikiComments",props:["type","sourceId"],data:function(){return{comments:null,reply_form:{content:"",user_nickname:k["a"].getInfo().name},page:1,pageSize:10,total:0,loading:!1}},computed:{client:function(){return location.href.includes("classic")||location.href.includes("origin")?"origin":"std"}},methods:{get_comments:function(){var t=this;function e(t,n){var i=[],s=function(){var s=t[a];if(!s)return"continue";if(s.parent_id===n){var o=e(s.children,s.id);s.children=o.map((function(t){return t.parent={user_id:s.user_id,user_nickname:s.user_nickname,id:s.id},t.reply_form={show:!1,content:"",user_nickname:k["a"].getInfo().name},t})),i.push(s)}};for(var a in t)s();return i}this.type&&this.sourceId&&(this.loading=!0,o["b"].list({type:this.type,id:this.sourceId},{client:this.client,page:this.page}).then((function(n){if(n=n.data,200===n.code){for(var i=n.data.comments,s=0;s<i.length;s++)i[s]["reply_form"]={show:!1,content:"",user_nickname:k["a"].getInfo().name};t.page=n.data.current_page,t.total=n.data.total,t.comments=e(i,0),t.loading=!1}}),(function(){t.comments=!1,t.loading=!1})))},create_comment:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t.content){var i={comment:{type:this.type,source_id:this.sourceId,parent_id:n,user_nickname:t.user_nickname||k["a"].getInfo().name,content:t.content},client:this.client};o["b"].post({data:i},{}).then((function(n){n=n.data,200===n.code?(t.content="",e.$message({message:"提交成功，请等待审核",type:"success"})):e.$message({message:"".concat(n.message),type:"warning"})}),(function(){e.$message({message:"网络异常，提交失败",type:"warning"})})).finally((function(){t.show=!1}))}else this.$message({message:"请先填写评论内容再尝试提交",type:"warning"})},handleCurrentChange:function(t){this.page=t,this.get_comments()}},components:{WikiPanel:c["a"],Comment:g},watch:{sourceId:{immediate:!0,handler:function(){this.get_comments()}}}},w=C,b=(n("8c22"),Object(f["a"])(w,u,m,!1,null,null,null)),x=b.exports,I={name:"PvxUser",components:{WikiPanel:c["a"],Article:r["a"],WikiRevisions:l["a"],WikiComments:x},props:{id:{required:!0},name:{type:String,default:""},type:{type:String,required:!0}},data:function(){return{wiki_post:{source:{},post:null},compatible:!1,is_empty:!0}},watch:{id:{immediate:!0,handler:function(){this.post_id?this.loadRevision():this.loadData()}},post_id:{handler:function(){this.loadRevision()}}},computed:{client:function(){return this.$store.state.client},post_id:function(){return this.$route.params.post_id},isRevision:function(){return!!this.$route.params.post_id},author_id:function(){var t,e;return~~(null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.user_id)},user_name:function(){var t,e;return null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.user_nickname},updated_at:function(){var t,e;return Object(_["ts2str"])(null===(t=this.wiki_post)||void 0===t||null===(e=t.post)||void 0===e?void 0:e.updated)},fav_title:function(){var t,e;return null===(t=this.wiki_post)||void 0===t||null===(e=t.source)||void 0===e?void 0:e.Name},authors:function(){var t,e,n;return this.isRevision?[]:(null===(t=this.wiki_post)||void 0===t||null===(e=t.users)||void 0===e||null===(n=e.filter((function(t){return t.id})))||void 0===n?void 0:n.map((function(t){return{user_id:t.id,user_avatar:t.avatar,display_name:t.nickname}})))||[]}},methods:{getLink:_["getLink"],loadData:function(){var t=this;this.id&&o["a"].mix({type:this.type,id:this.id,client:this.client},{supply:1}).then((function(e){var n=e.post,i=e.source,s=e.compatible,a=e.isEmpty,o=e.users;t.wiki_post={post:n,source:i,users:o},t.is_empty=a,t.compatible=s})),this.triggerStat()},loadRevision:function(){var t=this;o["a"].getById(this.post_id,{type:this.type}).then((function(e){var n;t.wiki_post=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.data})),this.triggerStat()},publish_url:_["publishLink"],triggerStat:function(){"origin"==this.client?Object(a["b"])("origin_".concat(type),this.id):Object(a["b"])(this.type,this.id)}}},$=I,P=(n("107cf"),Object(f["a"])($,i,s,!1,null,null,null));e["a"]=P.exports},"354f":function(t,e,n){},"8c22":function(t,e,n){"use strict";n("ac04")},ac04:function(t,e,n){}}]);
//# sourceMappingURL=chunk-9e42a320.9026d87c.js.map